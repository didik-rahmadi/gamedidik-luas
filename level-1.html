<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 1: Mengenal Bangun Datar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

    <style>
        /* --- FONT SETUP --- */
        @font-face { font-family: 'Chewy'; src: url('fonts/Chewy-Regular.ttf'); }
        @font-face { font-family: 'Fredoka'; src: url('fonts/Fredoka-Regular.ttf'); }

        /* --- GLOBAL STYLE --- */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Fredoka', sans-serif;
            background-color: #2C3E50;
            user-select: none; -webkit-user-select: none; touch-action: none;
        }

        #game-container {
            width: 1920px; height: 1080px;
            position: absolute; top: 50%; left: 50%;
            background: #E0F7FA url('assets/bg_level1.png') no-repeat center center; 
            background-size: cover;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            transform-origin: center center;
        }

        .hidden { display: none !important; }

        /* --- TOMBOL NAVIGASI UMUM --- */
        .btn-back-map {
            position: absolute; top: 40px; left: 40px;
            background: #e74c3c; color: white;
            padding: 10px 30px; border-radius: 30px; border: 4px solid #fff;
            font-family: 'Chewy'; font-size: 1.5rem; cursor: pointer; z-index: 50;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
        }
        .btn-back-map:active { transform: translateY(4px); box-shadow: none; }

        /* --- CSS GAME AREA (SLIDE 1) --- */
        .slide-section { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        
        .level-title { font-family: 'Chewy'; font-size: 4rem; color: #00838F; margin: 0; }
        .header-area { text-align: center; margin-top: 30px; margin-bottom: 20px; }

        .lvl1-game-area {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 100%; height: 75%; gap: 30px;
        }

        .lvl1-shapes-container { display: flex; gap: 40px; justify-content: center; }

        .lvl1-dropzone {
            width: 220px; height: 320px;
            background: rgba(255,255,255,0.7);
            border: 5px dashed #00838F; border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            padding: 20px; transition: all 0.3s;
        }
        .lvl1-dropzone.dragover { background: #E0F2F1; transform: scale(1.05); border-style: solid; }
        .lvl1-dropzone.correct { border-color: #2ecc71; background: #d5f5e3; border-style: solid; }

        .lvl1-shape-img {
            width: 100%; height: 160px; object-fit: contain;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
            margin-bottom: 10px; pointer-events: none;
        }

        .lvl1-slot {
            width: 100%; height: 60px;
            border: 2px solid #aaa; border-radius: 10px;
            background: rgba(0,0,0,0.1); color: #777;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3rem; font-weight: bold; pointer-events: none;
        }

        .lvl1-labels-container {
            display: flex; gap: 20px; padding: 25px;
            background: rgba(0, 131, 143, 0.2); border-radius: 20px;
            min-width: 500px; justify-content: center; align-items: center;
            border: 4px solid white;
        }

        .lvl1-draggable {
            background: #FFD93D; color: #d35400;
            padding: 15px 30px; border-radius: 15px;
            font-family: 'Chewy'; font-size: 1.8rem;
            cursor: grab; border: 3px solid #fff;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s; touch-action: none; 
        }
        .lvl1-draggable:active { cursor: grabbing; transform: scale(1.1); }

        /* --- MODAL STYLES --- */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: flex; justify-content: center; align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-box {
            background: white; border-radius: 30px; padding: 40px;
            text-align: center; width: 40%; border: 8px solid #FFD93D;
            box-shadow: 0 0 50px rgba(255, 217, 61, 0.5);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-title { font-family: 'Chewy'; font-size: 3.5rem; margin: 0 0 20px 0; color: #d35400; }
        .modal-text { font-size: 1.8rem; color: #555; margin-bottom: 30px; line-height: 1.5; }

        .btn-modal {
            padding: 15px 40px; font-family: 'Chewy'; font-size: 2rem;
            border: none; border-radius: 50px; cursor: pointer; margin: 0 10px;
            border: 4px solid transparent; transition: all 0.2s;
        }
        
        .btn-confirm-yes { background: #e74c3c; color: white; border-color: #c0392b; }
        .btn-confirm-no { background: #2ecc71; color: white; border-color: #27ae60; }
        .btn-next-slide { 
            background: linear-gradient(to bottom, #3498db, #2980b9); 
            color: white; border: 4px solid #fff; box-shadow: 0 8px 0 #1c5980;
        }
        .btn-next-slide:active { transform: translateY(4px); box-shadow: none; }

        /* Animasi */
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }

    </style>
</head>
<body>

    <div id="game-container">
        <button class="btn-back-map" onclick="attemptExit()">â¬… KEMBALI KE PETA</button>

        <div id="slide-1" class="slide-section">
            <div class="header-area">
                <h1 class="level-title">LEVEL 1: MENGENAL KEMBALI</h1>
                <h2 style="font-family:'Fredoka'; font-size: 1.8rem; color: #555; background: rgba(255,255,255,0.8); padding: 5px 30px; border-radius: 50px; display: inline-block;">
                    Tarik Nama Bangun ke Gambarnya! ðŸ‘‡
                </h2>
            </div>

            <div class="lvl1-game-area">
                <div class="lvl1-shapes-container">
                    <div class="lvl1-dropzone" data-target="persegi" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/persegi.png" class="lvl1-shape-img" alt="Persegi"> 
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>
                    
                    <div class="lvl1-dropzone" data-target="segitiga" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/segitiga.png" class="lvl1-shape-img" alt="Segitiga">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="ppanjang" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/persegi_panjang.png" class="lvl1-shape-img" alt="Persegi Panjang">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="jgenjang" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/jajar_genjang.png" class="lvl1-shape-img" alt="Jajar Genjang">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="trapesium" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/trapesium.png" class="lvl1-shape-img" alt="Trapesium">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>
                </div>

                <div class="lvl1-labels-container" id="lvl1-tray">
                    <div id="lbl-1" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="ppanjang">Persegi Panjang</div>
                    <div id="lbl-2" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="trapesium">Trapesium</div>
                    <div id="lbl-3" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="persegi">Persegi</div>
                    <div id="lbl-4" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="jgenjang">Jajar Genjang</div>
                    <div id="lbl-5" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="segitiga">Segitiga</div>
                </div>
            </div>
        </div>

        <div id="slide-2" class="slide-section hidden" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <h1 class="level-title">SLIDE 2</h1>
            <p style="font-size:2rem; color:white;">(Konten Slide 2 akan dibuat selanjutnya)</p>
            <button class="btn-back-map" style="position:relative; top:auto; left:auto; margin-top:20px;" onclick="saveAndExit()">SELESAI DEMO LEVEL 1</button>
        </div>

        <div id="modal-success" class="modal-overlay hidden">
            <div class="modal-box">
                <h1 class="modal-title">WAH, HEBAT! ðŸŒŸ</h1>
                <p class="modal-text">
                    Kamu masih mengingat nama dan bentuk bangun datar.<br>
                    Mari kita lanjutkan!
                </p>
                <button class="btn-modal btn-next-slide" onclick="nextSlide()">LANJUT â–¶</button>
            </div>
        </div>

        <div id="modal-exit" class="modal-overlay hidden">
            <div class="modal-box" style="border-color: #e74c3c;">
                <h1 class="modal-title" style="color: #c0392b;">TUNGGU DULU! âœ‹</h1>
                <p class="modal-text">
                    Kamu belum menyelesaikan misi pada level 1 ini.<br>
                    Apa kamu yakin ingin kembali ke peta?
                </p>
                <button class="btn-modal btn-confirm-no" onclick="closeExitModal()">BATAL</button>
                <button class="btn-modal btn-confirm-yes" onclick="forceExit()">YA, KELUAR</button>
            </div>
        </div>

    </div>

    <script>
        // --- SCALING ---
        function scaleContainer() {
            const container = document.getElementById('game-container');
            const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
            container.style.transform = `translate(-50%, -50%) scale(${scale})`;
        }
        window.addEventListener('load', () => { scaleContainer(); randomizeLabels(); });
        window.addEventListener('resize', scaleContainer);

        // --- GAME VARIABLES ---
        let matches = 0;
        const totalMatches = 5;
        let isSlide1Finished = false; // Penanda apakah misi sudah selesai

        // --- DRAG DROP LOGIC ---
        function randomizeLabels() {
            const tray = document.getElementById('lvl1-tray');
            const labels = Array.from(tray.children);
            labels.sort(() => Math.random() - 0.5);
            labels.forEach(lbl => tray.appendChild(lbl));
        }

        function allowDrop(ev) { ev.preventDefault(); ev.currentTarget.classList.add('dragover'); }
        document.querySelectorAll('.lvl1-dropzone').forEach(z => z.addEventListener('dragleave', () => z.classList.remove('dragover')));

        function dragLevel1(ev) {
            ev.dataTransfer.setData("id", ev.target.id);
            ev.dataTransfer.setData("type", ev.target.dataset.type);
        }

        function dropLevel1(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('dragover');

            const dataID = ev.dataTransfer.getData("id");
            const dataType = ev.dataTransfer.getData("type");
            const targetType = ev.currentTarget.dataset.target;

            if (dataType === targetType) {
                const draggedEl = document.getElementById(dataID);
                const slot = ev.currentTarget.querySelector('.lvl1-slot');
                
                slot.innerText = draggedEl.innerText;
                slot.style.background = "#2ecc71";
                slot.style.color = "white";
                slot.style.borderColor = "#27ae60";
                
                draggedEl.style.display = 'none'; 
                ev.currentTarget.classList.add('correct');
                
                matches++;
                if (matches === totalMatches) {
                    isSlide1Finished = true; // Tandai selesai
                    setTimeout(() => {
                        showSuccessModal();
                    }, 500);
                }
            } else {
                // Feedback visual salah (opsional: goyang kotak)
                ev.currentTarget.style.borderColor = "#c0392b";
                setTimeout(() => ev.currentTarget.style.borderColor = "#00838F", 500);
            }
        }

        // --- NAVIGATION LOGIC ---

        // 1. Tombol Kembali ke Peta
        function attemptExit() {
            if (isSlide1Finished) {
                // Jika sudah selesai misi slide 1 (atau semua slide), boleh keluar langsung?
                // Atau tetap tanya? Sesuai request: "Jika belum selesai misi..."
                // Mari kita asumsikan jika Slide 1 belum beres, tanya.
                // Tapi karena ini multi-slide, jika slide 1 beres tapi slide 2 belum, 
                // mungkin user ingin keluar.
                // Untuk amannya: Selalu tanya jika dipaksa keluar via tombol Peta.
                showExitModal();
            } else {
                showExitModal();
            }
        }

        function showExitModal() {
            document.getElementById('modal-exit').classList.remove('hidden');
        }

        function closeExitModal() {
            document.getElementById('modal-exit').classList.add('hidden');
        }

        function forceExit() {
            window.location.href = 'index.html';
        }

        // 2. Logika Modal Sukses & Lanjut Slide
        function showSuccessModal() {
            document.getElementById('modal-success').classList.remove('hidden');
            // Mainkan suara menang di sini jika ada
        }

        function nextSlide() {
            document.getElementById('modal-success').classList.add('hidden');
            
            // Pindah Slide
            document.getElementById('slide-1').classList.add('hidden');
            document.getElementById('slide-2').classList.remove('hidden');
            
            // Di sini nanti Bapak bisa inisialisasi game untuk Slide 2
        }

        // 3. Save & Exit (Dipanggil di Slide Terakhir nanti)
        function saveAndExit() {
            let currentMax = parseInt(localStorage.getItem('mathAdventure_maxLevel')) || 1;
            if (currentMax < 2) {
                localStorage.setItem('mathAdventure_maxLevel', 2);
            }
            window.location.href = 'index.html';
        }

    </script>
</body>
</html>