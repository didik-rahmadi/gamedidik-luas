<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 1: Mengenal Bangun Datar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Background Khusus Level 1 */
        #game-container { background-image: url('assets/bg_level1.png'); }
    </style>

</head>
<body>

    <div id="game-container">
        <button class="btn-back-map" onclick="attemptExit()">â¬… KEMBALI KE PETA</button>

        <div id="slide-1" class="slide-section">
            <div class="header-area">
                <h1 class="level-title">LEVEL 1: MENGENAL KEMBALI</h1>
                <h2 style="font-family:'Fredoka'; font-size: 1.8rem; color: #555; background: rgba(255,255,255,0.8); padding: 5px 30px; border-radius: 50px; display: inline-block;">
                    Tarik Nama Bangun ke Gambarnya! ðŸ‘‡
                </h2>
            </div>

            <div class="lvl1-game-area">
                <div class="lvl1-shapes-container">
                    <div class="lvl1-dropzone" data-target="persegi" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/persegi.png" class="lvl1-shape-img" alt="Persegi"> 
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>
                    
                    <div class="lvl1-dropzone" data-target="segitiga" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/segitiga.png" class="lvl1-shape-img" alt="Segitiga">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="ppanjang" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/persegi_panjang.png" class="lvl1-shape-img" alt="Persegi Panjang">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="jgenjang" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/jajar_genjang.png" class="lvl1-shape-img" alt="Jajar Genjang">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>

                    <div class="lvl1-dropzone" data-target="trapesium" ondragover="allowDrop(event)" ondrop="dropLevel1(event)">
                        <img src="assets/trapesium.png" class="lvl1-shape-img" alt="Trapesium">
                        <div class="lvl1-slot">Letakkan Disini</div>
                    </div>
                </div>

                <div class="lvl1-labels-container" id="lvl1-tray">
                    <div id="lbl-1" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="ppanjang">Persegi Panjang</div>
                    <div id="lbl-2" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="trapesium">Trapesium</div>
                    <div id="lbl-3" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="persegi">Persegi</div>
                    <div id="lbl-4" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="jgenjang">Jajar Genjang</div>
                    <div id="lbl-5" class="lvl1-draggable" draggable="true" ondragstart="dragLevel1(event)" data-type="segitiga">Segitiga</div>
                </div>
            </div>
        </div>

        <div id="slide-2" class="slide-section hidden" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <h1 class="level-title">SLIDE 2</h1>
            <p style="font-size:2rem; color:white;">(Konten Slide 2 akan dibuat selanjutnya)</p>
            <button class="btn-back-map" style="position:relative; top:auto; left:auto; margin-top:20px;" onclick="saveAndExit()">SELESAI DEMO LEVEL 1</button>
        </div>

        <div id="modal-success" class="modal-overlay hidden">
            <div class="modal-box">
                <h1 class="modal-title">WAH, HEBAT! ðŸŒŸ</h1>
                <p class="modal-text">
                    Kamu masih mengingat nama dan bentuk bangun datar.<br>
                    Mari kita lanjutkan!
                </p>
                <button class="btn-modal btn-next-slide" onclick="nextSlide()">LANJUT â–¶</button>
            </div>
        </div>

        <div id="modal-exit" class="modal-overlay hidden">
            <div class="modal-box" style="border-color: #e74c3c;">
                <h1 class="modal-title" style="color: #c0392b;">TUNGGU DULU! âœ‹</h1>
                <p class="modal-text">
                    Kamu belum menyelesaikan misi pada level 1 ini.<br>
                    Apa kamu yakin ingin kembali ke peta?
                </p>
                <button class="btn-modal btn-confirm-no" onclick="closeExitModal()">BATAL</button>
                <button class="btn-modal btn-confirm-yes" onclick="forceExit()">YA, KELUAR</button>
            </div>
        </div>

    </div>
    
    <script src="game-engine.js"></script>
    <script>
        // --- GAME VARIABLES ---
        let matches = 0;
        const totalMatches = 5;
        let isSlide1Finished = false; // Penanda apakah misi sudah selesai

        // --- DRAG DROP LOGIC ---
        function randomizeLabels() {
            const tray = document.getElementById('lvl1-tray');
            const labels = Array.from(tray.children);
            labels.sort(() => Math.random() - 0.5);
            labels.forEach(lbl => tray.appendChild(lbl));
        }

        function allowDrop(ev) { ev.preventDefault(); ev.currentTarget.classList.add('dragover'); }
        document.querySelectorAll('.lvl1-dropzone').forEach(z => z.addEventListener('dragleave', () => z.classList.remove('dragover')));

        function dragLevel1(ev) {
            ev.dataTransfer.setData("id", ev.target.id);
            ev.dataTransfer.setData("type", ev.target.dataset.type);
        }

        function dropLevel1(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('dragover');

            const dataID = ev.dataTransfer.getData("id");
            const dataType = ev.dataTransfer.getData("type");
            const targetType = ev.currentTarget.dataset.target;

            if (dataType === targetType) {
                const draggedEl = document.getElementById(dataID);
                const slot = ev.currentTarget.querySelector('.lvl1-slot');
                
                slot.innerText = draggedEl.innerText;
                slot.style.background = "#2ecc71";
                slot.style.color = "white";
                slot.style.borderColor = "#27ae60";
                
                draggedEl.style.display = 'none'; 
                ev.currentTarget.classList.add('correct');
                
                matches++;
                if (matches === totalMatches) {
                    isSlide1Finished = true; // Tandai selesai
                    setTimeout(() => {
                        showSuccessModal();
                    }, 500);
                }
            } else {
                // Feedback visual salah (opsional: goyang kotak)
                ev.currentTarget.style.borderColor = "#c0392b";
                setTimeout(() => ev.currentTarget.style.borderColor = "#00838F", 500);
            }
        }

        // --- NAVIGATION LOGIC ---

        // 1. Tombol Kembali ke Peta
        function attemptExit() {
            if (isSlide1Finished) {
                // Jika sudah selesai misi slide 1 (atau semua slide), boleh keluar langsung?
                // Atau tetap tanya? Sesuai request: "Jika belum selesai misi..."
                // Mari kita asumsikan jika Slide 1 belum beres, tanya.
                // Tapi karena ini multi-slide, jika slide 1 beres tapi slide 2 belum, 
                // mungkin user ingin keluar.
                // Untuk amannya: Selalu tanya jika dipaksa keluar via tombol Peta.
                showExitModal();
            } else {
                showExitModal();
            }
        }

        function showExitModal() {
            document.getElementById('modal-exit').classList.remove('hidden');
        }

        function closeExitModal() {
            document.getElementById('modal-exit').classList.add('hidden');
        }

        // 2. Logika Modal Sukses & Lanjut Slide
        function showSuccessModal() {
            document.getElementById('modal-success').classList.remove('hidden');
            // Mainkan suara menang di sini jika ada
        }

        function nextSlide() {
            document.getElementById('modal-success').classList.add('hidden');
            
            // Pindah Slide
            document.getElementById('slide-1').classList.add('hidden');
            document.getElementById('slide-2').classList.remove('hidden');
            
            // Di sini nanti Bapak bisa inisialisasi game untuk Slide 2
        }

    </script>
</body>
</html>
